/*
 * This file was generated by the Gradle 'init' task.
 */
plugins {
    id 'war'
    id "cz.habarta.typescript-generator" version "2.36.1070"
}

import cz.habarta.typescript.generator.JsonLibrary
import cz.habarta.typescript.generator.TypeScriptFileType

tasks {
    generateTypeScript {
        jsonLibrary = JsonLibrary.jackson2
        outputFileType = TypeScriptFileType.implementationFile
        classes = [
                'org.endeavourhealth.imapi.model.search.SearchRequest',
                'org.endeavourhealth.imapi.model.search.SearchResponse'
        ]
        classPatterns = [
                'org.endeavourhealth.imapi.model.sets.*'
        ]
        outputFile = '../../IMLibrary/src/models/modules/AutoGen.ts'
        outputKind = 'module'
    }
}

sonarqube {
    properties {
        property 'sonar.projectKey', 'endeavourhealth-discovery_IMAPI::api'
        property 'sonar.exclusions', '**/config/**, **/controllers/**, **/dataaccess/**, **/errorhandling/**, **/model/**, **/parser/**, **/vocabulary/**'
    }
}

war {
    archiveFileName = 'imapi.war'
}

dependencies {
    implementation libs.antlr
    implementation libs.apacheCollections4
    implementation libs.apachePoi
    implementation libs.apacheText
    implementation libs.factPlusPlus
    implementation libs.jacksonDatabind
    implementation libs.logbackCore
    implementation libs.logbackClassic
    implementation libs.elasticsearch
    implementation libs.owlApi
    implementation libs.reactorCore
    implementation libs.rdf4jQuery
    implementation libs.rdf4jRepoApi
    implementation libs.rdf4jRepoHttp
    implementation libs.rdf4jRepoSail
    implementation libs.rdf4jSailNative
    implementation libs.slf4j
    implementation libs.springContext
    implementation libs.springDataJpa
    implementation libs.springOauthServer
    implementation libs.springSecurity
    implementation libs.springStatemachine
    implementation libs.springWeb
    implementation libs.springdoc
    implementation libs.validation
    implementation libs.woodstox
    implementation libs.awsS3
    runtimeOnly libs.h2database
    runtimeOnly libs.springDevTools

    testImplementation libs.cucumber
    testImplementation libs.cucumberJunit
    testImplementation libs.junitRunner
    testImplementation libs.junitVintage
    testImplementation libs.mockito
    testImplementation libs.springTest
    testImplementation libs.springTestSecurity

    providedCompile libs.springTomcat

    compileOnly libs.jacksonAnnotations
    compileOnly libs.lombok

    annotationProcessor libs.jacksonAnnotations
    annotationProcessor libs.lombok
}

publishing {
    repositories {
        maven {
            url = uri('https://maven.discoverydataservice.net/artifactory/libs-snapshot')
        }
    }
}

test {
    useJUnitPlatform()
}

configurations {
    cucumberRuntime {
        extendsFrom testImplementation
    }
}

task cucumberCli() {
    dependsOn assemble, testClasses
    doLast {
        javaexec {
            main = "io.cucumber.core.cli.Main"
            classpath = configurations.cucumberRuntime + sourceSets.main.output + sourceSets.test.output
            args = [
                    '--plugin', 'pretty',
                    '--plugin', 'html:build/reports/cucumber/cucumber-report.html',
                    '--glue', 'org.endeavourhealth.imapi',
                    'src/test/resources']
        }
    }
}

description = 'Information Model API'
