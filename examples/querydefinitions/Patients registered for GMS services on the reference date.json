{
  "@id" : "http://endhealth.info/im#Q_RegisteredGMS",
  "name" : "Patients registered for GMS services on the reference date",
  "description" : "For any registration period,a registration start date before the reference date and no end date,or an end date after the reference date.",
  "select" : {
    "entityType" : {
      "name" : "Person",
      "@id" : "http://endhealth.info/im#Person"
    },
    "filter" : {
      "property" : {
        "name" : "has GP registration",
        "@id" : "http://endhealth.info/im#isSubjectOf"
      },
      "valueObject" : {
        "entityType" : {
          "@id" : "http://endhealth.info/im#GPRegistration"
        },
        "and" : [ {
          "name" : "patient type is regular GMS Patient",
          "property" : {
            "@id" : "http://endhealth.info/im#patientType"
          },
          "valueConcept" : [ {
            "name" : "Regular GMS patient",
            "@id" : "http://endhealth.info/im#2751000252106"
          } ]
        }, {
          "name" : "start of registration is before the reference date",
          "property" : {
            "@id" : "http://endhealth.info/im#effectiveDate"
          },
          "valueCompare" : {
            "comparison" : "LESS_THAN_OR_EQUAL",
            "valueData" : "$ReferenceDate"
          }
        } ],
        "or" : [ {
          "name" : "the registration has not ended ",
          "notExist" : true,
          "property" : {
            "@id" : "http://endhealth.info/im#endDate"
          }
        }, {
          "name" : "the end of registration is after the reference date",
          "property" : {
            "@id" : "http://endhealth.info/im#endDate"
          },
          "valueCompare" : {
            "comparison" : "GREATER_THAN",
            "valueData" : "$ReferenceDate"
          }
        } ]
      }
    }
  }
}