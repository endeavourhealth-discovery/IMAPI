import java.nio.charset.StandardCharsets
import java.nio.file.Files
import java.nio.file.StandardOpenOption

tasks.register("typescriptConstEnumToEnum") {
  group = "other"
  description = "Changes typescript generated const enums to standard enums for functionality"
  dependsOn("generateTypeScript")
  doLast {
    def file = new File(rootDir, "../IMDirectory/src/interfaces/AutoGen.ts")
    if (!file.exists()) {
      throw new GradleException("Autogen file not found. Run generateTypescript to create it.")
    }
    def content = file.getText("UTF-8")
    def replaced = content.replaceAll("const enum", "enum")
    Files.write(
      file.toPath(),
      replaced.getBytes(StandardCharsets.UTF_8),
      StandardOpenOption.TRUNCATE_EXISTING
    )
  }
}