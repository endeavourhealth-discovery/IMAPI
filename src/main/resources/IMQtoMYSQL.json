{
  "properties": [
    {
      "path": [
        "http://endhealth.info/im#patient"
      ],
      "dataModel": "http://endhealth.info/im#Patient"
    },
    {
      "path": [
        "http://endhealth.info/im#appointment"
      ],
      "dataModel": "http://endhealth.info/im#Appointment"
    },
    {
      "path": [
        "http://endhealth.info/im#encounter"
      ],
      "dataModel": "http://endhealth.info/im#Encounter"
    },
    {
      "path": [
        "http://endhealth.info/im#mobileTelephoneNumber"
      ],
      "dataModel": "http://endhealth.info/im#MobileTelephoneNumber"
    },
    {
      "path": [
        "http://endhealth.info/im#provider"
      ],
      "dataModel": "http://endhealth.info/im#Organisation"
    },
    {
      "path": [
        "http://endhealth.info/im#gpRegistrationAtEvent",
        "http://endhealth.info/im#provider"
      ],
      "dataModel": "http://endhealth.info/im#Organisation"
    },
    {
      "path": [
        "http://endhealth.info/im#statedGender"
      ],
      "dataModel": "http://endhealth.info/im#statedGenderConcept"
    },
    {
      "path": [
        "http://endhealth.info/im#ethnicity"
      ],
      "dataModel": "http://endhealth.info/im#ethnicityConcept"
    },
    {
      "path": [
        "http://endhealth.info/im#concept"
      ],
      "dataModel": "http://endhealth.info/im#Concept"
    },
    {
      "path": [
        "http://endhealth.info/im#provenance",
        "http://endhealth.info/im#recordOwner"
      ],
      "dataModel": "http://endhealth.info/im#Organisation"
    },
    {
      "path": [
        "http://endhealth.info/im#observation"
      ],
      "dataModel": "http://endhealth.info/im#Observation"
    },
    {
      "path": [
        "http://endhealth.info/im#clinicalEntry"
      ],
      "dataModel": "http://endhealth.info/im#ClinicalEntry"
    },
    {
      "path": [
        "http://endhealth.info/im#gPRegistration"
      ],
      "dataModel": "http://endhealth.info/im#GPRegistration"
    },
    {
      "path": [
        "http://endhealth.info/im#prescription"
      ],
      "dataModel": "http://endhealth.info/im#MedicationRequest"
    },
    {
      "path": [
        "http://endhealth.info/im#medicationRequest"
      ],
      "dataModel": "http://endhealth.info/im#MedicationRequest"
    },
    {
      "path": [
        "http://endhealth.info/im#episodeOfCare"
      ],
      "dataModel": "http://endhealth.info/im#EpisodeOfCare"
    },
    {
      "path": [
        "http://endhealth.info/im#gmsRegistrationAtEvent"
      ],
      "dataModel": "http://endhealth.info/im#EpisodeOfCare"
    },
    {
      "path": [
        "http://endhealth.info/im#usualGP"
      ],
      "dataModel": "http://endhealth.info/im#PersonInRole"
    },
    {
      "path": [
        "http://endhealth.info/im#homeAddress"
      ],
      "dataModel": "http://endhealth.info/im#Address"
    }
  ],
  "tables": [
    {
      "dataModels": [
        "http://endhealth.info/im#MobileTelephoneNumber"
      ],
      "table": "patient_contact",
      "condition": "type_concept_id = 1335362",
      "relationships": {
        "http://endhealth.info/im#Patient": {
          "fromField": "patient_id",
          "toField": "id"
        }
      }
    },
    {
      "dataModels": [
        "http://endhealth.info/im#Address"
      ],
      "table": "patient_address",
      "relationships": {
        "http://endhealth.info/im#Patient": {
          "fromField": "patient_id",
          "toField": "id"
        }
      }
    },
    {
      "dataModels": [
        "http://endhealth.info/im#Patient"
      ],
      "table": "patient",
      "fields": {
        "http://endhealth.info/im#age": {
          "field": "TIMESTAMPDIFF({units}, {dateOfBirth}, {relativeTo})",
          "type": "number",
          "function": true
        },
        "http://endhealth.info/im#dateOfBirth": {
          "field": "date_of_birth",
          "type": "date"
        },
        "http://endhealth.info/im#pseudonymisedId": {
          "field": "id",
          "type": "string"
        },
        "http://endhealth.info/im#id": {
          "field": "person_id",
          "type": "string"
        },
        "http://endhealth.info/im#forenames": {
          "field": "first_names",
          "type": "string"
        },
        "http://endhealth.info/im#familyName": {
          "field": "last_name",
          "type": "string"
        },
        "http://endhealth.info/im#dateOfDeath": {
          "field": "date_of_death",
          "type": "date"
        },
        "http://endhealth.info/im#statedGender": {
          "field": "gender_concept_id",
          "type": "iri"
        },
        "http://endhealth.info/im#nhsNumber": {
          "field": "nhs_number",
          "type": "string"
        },
        "http://endhealth.info/im#ethnicity": {
          "field": "ethnic_code_concept_id",
          "type": "iri"
        }
      }
    },
    {
      "dataModels": [
        "http://endhealth.info/im#PersonInRole"
      ],
      "table": "practitioner",
      "fields": {
        "http://endhealth.info/im#dateOfBirth": {
          "field": "date_of_birth",
          "type": "date"
        },
        "http://endhealth.info/im#mnemonic": {
          "field": "name",
          "type": "string"
        }
      }
    },
    {
      "dataModels": [
        "http://endhealth.info/im#Observation",
        "http://endhealth.info/im#ClinicalEntry"
      ],
      "table": "observation",
      "fields": {
        "http://endhealth.info/im#concept": {"field": "core_concept_id", "type": "iri"},
        "http://endhealth.info/im#effectiveDate": {"field": "clinical_effective_date", "type": "date"},
        "http://endhealth.info/im#value": {"field": "result_value", "type": "number"},
        "http://endhealth.info/im#ageAtEvent": {"field": "age_at_event", "type": "number"},
        "http://endhealth.info/im#problemEpisode": {"field": "episodicity_concept_id", "type": "iri"},
        "http://endhealth.info/im#text": {"field": "result_text", "type": "string"},
        "http://endhealth.info/im#units": {"field": "result_value_units", "type": "string"}
      },
      "relationships": {
        "http://endhealth.info/im#Patient": {"fromField": "patient_id", "toField": "id"},
        "http://endhealth.info/im#Organisation": {"fromField": "organization_id", "toField": "id"},
        "http://endhealth.info/im#Concept": {"fromField": "core_concept_id", "toField": "dbid"},
        "http://endhealth.info/im#Encounter": {"fromField": "encounter_id", "toField": "id"}
      }
    },
    {
      "dataModels": [
        "http://endhealth.info/im#Encounter"
      ],
      "table": "encounter",
      "fields": {
        "http://endhealth.info/im#concept": {"field": "core_concept_id", "type": "iri"},
        "http://endhealth.info/im#effectiveDate": {"field": "clinical_effective_date", "type": "date"},
        "http://endhealth.info/im#effectiveTime": {"field": "clinical_effective_date", "type": "date"},
        "http://endhealth.info/im#appointmentType": {"field": "type", "type": "string"}
      },
      "relationships": {
        "http://endhealth.info/im#Patient": {"fromField": "patient_id", "toField": "id"}
      }
    },
    {
      "dataModels": [
        "http://endhealth.info/im#Appointment"
      ],
      "table": "appointment",
      "fields": {
        "http://endhealth.info/im#concept": {"field": "core_concept_id", "type": "iri"},
        "http://endhealth.info/im#effectiveDate": {"field": "clinical_effective_date", "type": "date"},
        "http://endhealth.info/im#effectiveTime": {"field": "clinical_effective_date", "type": "date"},
        "http://endhealth.info/im#appointmentType": {"field": "type", "type": "string"}
      },
      "relationships": {
        "http://endhealth.info/im#Patient": {"fromField": "patient_id", "toField": "id"}
      }
    },
    {
      "dataModels": [
        "http://endhealth.info/im#Organisation"
      ],
      "table": "organization",
      "fields": {
        "http://endhealth.info/im#odsCode": {"field": "ods_code", "type": "string"},
        "http://www.w3.org/2000/01/rdf-schema#label": {"field": "name", "type": "string"}
      },
      "relationships": {
        "http://endhealth.info/im#Patient": {"fromField": "id", "toField": "organization_id"}
      }
    },
    {
      "dataModels": [
        "http://endhealth.info/im#MedicationRequest"
      ],
      "table": "medication_order",
      "fields": {
        "http://endhealth.info/im#concept": {"field": "core_concept_id", "type": "iri"},
        "http://endhealth.info/im#effectiveDate": {"field": "clinical_effective_date", "type": "date"},
        "http://endhealth.info/im#dosage": {"field": "dose", "type": "string"},
        "http://endhealth.info/im#quantity_http://endhealth.info/im#value": {
          "field": "quantity_value", "type": "number"
        },
        "http://endhealth.info/im#quantity_http://endhealth.info/im#units": {"field": "quantity_unit", "type": "string"}
      },
      "relationships": {
        "http://endhealth.info/im#Patient": {"fromField": "patient_id", "toField": "id"},
        "http://endhealth.info/im#Organisation": {"fromField": "organization_id", "toField": "id"},
        "http://endhealth.info/im#Concept": {"fromField": "core_concept_id", "toField": "dbid"}
      }
    },
    {
      "dataModels": [
        "http://endhealth.info/im#EpisodeOfCare"
      ],
      "table": "episode_of_care",
      "fields": {
        "http://endhealth.info/im#concept": {"field": "concept", "type": "iri"},
        "http://endhealth.info/im#gmsPatientType": {"field": "registration_type_concept_id", "type": "iri"},
        "http://endhealth.info/im#gpPatientType": {"field": "gpPatientType", "type": "iri"},
        "http://endhealth.info/im#effectiveDate": {"field": "date_registered", "type": "date"},
        "http://endhealth.info/im#endDate": {"field": "date_registered_end", "type": "date"}
      },
      "relationships": {
        "http://endhealth.info/im#Patient": {"fromField": "patient_id", "toField": "id"},
        "http://endhealth.info/im#PersonInRole": {"fromField": "usual_gp_practitioner_id", "toField": "id"},
        "http://endhealth.info/im#Organisation": {"fromField": "organization_id", "toField": "id"}
      }
    },
    {
      "dataModels": [
        "http://endhealth.info/im#Concept"
      ],
      "table": "concept",
      "primaryKey": "dbid",
      "fields": {
        "http://www.w3.org/2000/01/rdf-schema#label": {"field": "name", "type": "string"}
      }
    },
    {
      "dataModels": [
        "http://endhealth.info/im#ethnicityConcept"
      ],
      "table": "concept",
      "primaryKey": "dbid",
      "fields": {
        "http://www.w3.org/2000/01/rdf-schema#label": {"field": "name", "type": "string"}
      },
      "relationships": {
        "http://endhealth.info/im#Patient": {"fromField": "dbid", "toField": "ethnic_code_concept_id"}
      }
    },
    {
      "dataModels": [
        "http://endhealth.info/im#statedGenderConcept"
      ],
      "table": "concept",
      "primaryKey": "dbid",
      "fields": {
        "http://www.w3.org/2000/01/rdf-schema#label": {"field": "name", "type": "string"}
      },
      "relationships": {
        "http://endhealth.info/im#Patient": {"fromField": "dbid", "toField": "gender_concept_id"}
      }
    }
  ],
  "functions": {
    "http://endhealth.info/im#age": "TIMESTAMPDIFF({units}, {dateOfBirth}, {relativeTo})",
    "http://endhealth.info/im#TimeDifference": "TIMESTAMPDIFF({units}, {firstDateTime}, {relativeTo}",
    "http://endhealth.info/im#Count": "COUNT(*) AS count",
    "http://endhealth.info/im#Average": "AVG({propertyName}) AS average_{propertyName}",
    "http://endhealth.info/im#Sum": "SUM({propertyName}) AS sum_{propertyName}",
    "http://endhealth.info/im#Max": "MAX({propertyName}) AS max_{propertyName}",
    "http://endhealth.info/im#Min": "MIN({propertyName}) AS min_{propertyName}",
    "http://endhealth.info/im#Concatenate": "GROUP_CONCAT(DISTINCT {propertyName} SEPARATOR ', ') AS concat_{propertyName}"
  }
}
